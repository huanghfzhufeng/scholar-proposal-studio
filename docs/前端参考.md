import React, { useState, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { 
  Sparkles, MessageSquareText, FileText, Database, PenTool, 
  ArrowRight, CheckCircle2, Cpu, ShieldCheck, Zap, 
  LayoutDashboard, Plus, ChevronRight, MoreHorizontal, 
  Bot, User, RefreshCw, FileDown, ArrowLeft, Search,
  BookOpen, History, Settings, LogOut, X, Menu
} from 'lucide-react';

// --- 1. Font & Style Loader ---
const FontLoader = () => (
  <style>{`
    @import url('https://fonts.googleapis.com/css2?family=Calistoga&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Serif+SC:wght@400;700&display=swap');
    
    :root {
      --font-display: 'Calistoga', serif;
      --font-body: 'Inter', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
      --font-doc: 'Noto Serif SC', serif;
      --color-accent: #0052FF;
      --color-accent-secondary: #4D7CFF;
      --color-slate-900: #0F172A;
      --color-bg: #FAFAFA;
    }

    body {
      background-color: var(--color-bg);
      font-family: var(--font-body);
      color: var(--color-slate-900);
      overflow-x: hidden;
    }

    h1, h2, h3, h4 {
      font-family: var(--font-display);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: #CBD5E1;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #94A3B8;
    }

    .font-mono-custom { font-family: var(--font-mono); }
    .font-doc { font-family: var(--font-doc); }

    .text-gradient {
      background: linear-gradient(135deg, #0052FF 0%, #4D7CFF 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .bg-gradient-primary {
      background: linear-gradient(135deg, #0052FF 0%, #4D7CFF 100%);
    }

    .card-hover-effect {
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .card-hover-effect:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 52, 255, 0.15), 0 8px 10px -6px rgba(0, 52, 255, 0.1);
    }

    .hero-pattern {
      background-image: radial-gradient(circle, #0052FF 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.03;
    }
  `}</style>
);

// --- 2. Shared UI Components ---

const SectionLabel = ({ text }) => (
  <div className="inline-flex items-center gap-2 mb-6">
    <span className="relative flex h-2.5 w-2.5">
      <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
      <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-[#0052FF]"></span>
    </span>
    <span className="font-mono-custom text-xs uppercase tracking-[0.15em] text-[#0052FF] font-medium">
      {text}
    </span>
  </div>
);

const Button = ({ children, variant = 'primary', className = '', icon: Icon, onClick, size = 'default' }) => {
  const baseStyle = "relative inline-flex items-center justify-center rounded-xl font-medium transition-all duration-200 active:scale-95 group overflow-hidden disabled:opacity-50 disabled:pointer-events-none";
  
  const sizes = {
    sm: "h-9 px-4 text-xs",
    default: "h-12 px-8 text-sm",
    lg: "h-14 px-10 text-base"
  };

  const variants = {
    primary: "bg-gradient-primary text-white shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 hover:-translate-y-0.5",
    outline: "bg-white border border-slate-200 text-slate-700 hover:border-blue-200 hover:bg-slate-50",
    ghost: "bg-transparent text-slate-600 hover:text-[#0052FF] hover:bg-blue-50/50",
    secondary: "bg-white text-slate-900 border border-slate-200 shadow-sm hover:border-blue-200 hover:bg-slate-50"
  };

  return (
    <button onClick={onClick} className={`${baseStyle} ${sizes[size]} ${variants[variant]} ${className}`}>
      {children}
      {Icon && <Icon className="ml-2 w-4 h-4 transition-transform group-hover:translate-x-1" />}
    </button>
  );
};

const Badge = ({ children, color = 'blue' }) => {
  const styles = {
    blue: "bg-blue-50 text-blue-700 border-blue-100",
    green: "bg-emerald-50 text-emerald-700 border-emerald-100",
    amber: "bg-amber-50 text-amber-700 border-amber-100",
    slate: "bg-slate-100 text-slate-600 border-slate-200"
  };
  return (
    <span className={`px-2.5 py-0.5 rounded-full text-[10px] font-mono-custom uppercase tracking-wider font-medium border ${styles[color]}`}>
      {children}
    </span>
  );
};

// --- 3. Functional Views (Application Pages) ---

// --- View A: Dashboard ---
const Dashboard = ({ onNavigate }) => {
  const projects = [
    { id: 1, title: "基于深度学习的蛋白质结构预测研究", status: "drafting", progress: 85, lastEdit: "2小时前" },
    { id: 2, title: "新型纳米材料在光催化中的应用", status: "outline", progress: 40, lastEdit: "1天前" },
    { id: 3, title: "城市复杂交通流的多模态感知", status: "interview", progress: 15, lastEdit: "3天前" },
  ];

  return (
    <div className="p-6 md:p-12 max-w-7xl mx-auto w-full animate-in fade-in duration-500">
      <div className="flex justify-between items-end mb-10">
        <div>
          <SectionLabel text="Workspace" />
          <h2 className="text-3xl text-slate-900 mb-2 mt-2">工作台</h2>
          <p className="text-slate-500">欢迎回来，张教授。您有 3 个项目正在进行中。</p>
        </div>
        <Button onClick={() => onNavigate('interview')} icon={Plus}>新建项目</Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4">
          <div className="w-12 h-12 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center"><FileText /></div>
          <div>
            <div className="text-2xl font-bold font-serif text-slate-900">12</div>
            <div className="text-xs text-slate-500 font-mono-custom uppercase tracking-wider">Total Projects</div>
          </div>
        </div>
        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4">
          <div className="w-12 h-12 rounded-xl bg-green-50 text-green-600 flex items-center justify-center"><CheckCircle2 /></div>
          <div>
            <div className="text-2xl font-bold font-serif text-slate-900">2</div>
            <div className="text-xs text-slate-500 font-mono-custom uppercase tracking-wider">Completed</div>
          </div>
        </div>
        <div className="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4">
          <div className="w-12 h-12 rounded-xl bg-amber-50 text-amber-600 flex items-center justify-center"><Cpu /></div>
          <div>
            <div className="text-2xl font-bold font-serif text-slate-900">45h</div>
            <div className="text-xs text-slate-500 font-mono-custom uppercase tracking-wider">AI Saved Time</div>
          </div>
        </div>
      </div>

      <h3 className="text-xl text-slate-900 mb-6 font-bold">最近项目</h3>
      <div className="grid gap-4">
        {projects.map(p => (
          <div key={p.id} className="group bg-white p-6 rounded-xl border border-slate-100 hover:border-blue-200 hover:shadow-lg hover:shadow-blue-500/5 transition-all cursor-pointer flex items-center justify-between"
               onClick={() => onNavigate(p.status === 'drafting' ? 'editor' : p.status === 'outline' ? 'outline' : 'interview')}>
            <div className="flex items-center gap-6">
              <div className={`w-1.5 h-12 rounded-full ${
                p.status === 'drafting' ? 'bg-green-500' : p.status === 'outline' ? 'bg-amber-500' : 'bg-blue-500'
              }`} />
              <div>
                <h4 className="text-lg font-bold text-slate-900 mb-1 group-hover:text-[#0052FF] transition-colors">{p.title}</h4>
                <div className="flex items-center gap-4 text-sm text-slate-500">
                  <span className="flex items-center gap-1"><History size={14}/> 编辑于 {p.lastEdit}</span>
                  <span className="w-1 h-1 rounded-full bg-slate-300" />
                  <span>进度 {p.progress}%</span>
                </div>
              </div>
            </div>
            <div className="flex items-center gap-6">
              {p.status === 'drafting' && <Badge color="green">正文撰写</Badge>}
              {p.status === 'outline' && <Badge color="amber">大纲修订</Badge>}
              {p.status === 'interview' && <Badge color="blue">需求访谈</Badge>}
              <ChevronRight className="text-slate-300 group-hover:text-[#0052FF]" />
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

// --- View B: Interview (Chat) ---
const Interview = ({ onNavigate }) => {
  const [messages, setMessages] = useState([
    { role: 'ai', text: '张教授您好，我是您的科研申报助手。针对2026年国自然申请，我们首先需要确定您的选题方向。请问您这次计划申报的具体科学问题是什么？' }
  ]);
  const [input, setInput] = useState('');
  const scrollRef = useRef(null);

  const handleSend = () => {
    if (!input.trim()) return;
    setMessages([...messages, { role: 'user', text: input }]);
    setInput('');
    setTimeout(() => {
      setMessages(prev => [...prev, { role: 'ai', text: '好的，这个切入点非常有新意。关于这个机制，您目前是否已经有一定的预实验数据支持？这对于“研究基础”部分的构建至关重要。' }]);
    }, 1000);
  };

  useEffect(() => {
    scrollRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  return (
    <div className="flex h-[calc(100vh-80px)] w-full animate-in fade-in">
      {/* Sidebar Info */}
      <div className="w-80 bg-white border-r border-slate-200 p-6 hidden lg:flex flex-col">
        <div className="mb-8">
          <Button variant="ghost" size="sm" icon={ArrowLeft} className="mb-4 -ml-4" onClick={() => onNavigate('dashboard')}>返回工作台</Button>
          <h3 className="text-xl mb-2 font-bold">项目访谈</h3>
          <p className="text-sm text-slate-500">AI 正在引导您梳理核心申报逻辑。</p>
        </div>
        <div className="space-y-6">
          <div className="p-4 bg-blue-50 rounded-xl border border-blue-100">
            <div className="text-xs font-mono-custom text-blue-600 uppercase mb-1">Current Focus</div>
            <div className="font-bold text-slate-900">立项依据 - 科学问题</div>
          </div>
          <div className="space-y-2">
            <div className="flex justify-between text-xs font-medium text-slate-500">
              <span>信息收集进度</span>
              <span>15%</span>
            </div>
            <div className="h-2 bg-slate-100 rounded-full overflow-hidden">
              <div className="h-full bg-[#0052FF] w-[15%]" />
            </div>
          </div>
        </div>
        <div className="mt-auto">
          <Button className="w-full" variant="secondary" onClick={() => onNavigate('outline')}>跳过访谈，生成大纲</Button>
        </div>
      </div>

      {/* Chat Area */}
      <div className="flex-1 flex flex-col bg-[#FAFAFA] relative">
        <div className="flex-1 overflow-y-auto p-6 lg:p-12 space-y-8">
          {messages.map((msg, idx) => (
            <motion.div 
              key={idx}
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              className={`flex gap-4 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}
            >
              <div className={`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center shadow-sm ${msg.role === 'ai' ? 'bg-gradient-primary text-white' : 'bg-white border border-slate-200 text-slate-600'}`}>
                {msg.role === 'ai' ? <Bot size={20} /> : <User size={20} />}
              </div>
              <div className={`max-w-2xl p-6 rounded-2xl text-base leading-relaxed shadow-sm ${
                msg.role === 'ai' 
                  ? 'bg-white border border-slate-100 text-slate-800 rounded-tl-none' 
                  : 'bg-[#0052FF] text-white rounded-tr-none shadow-blue-500/20'
              }`}>
                {msg.text}
              </div>
            </motion.div>
          ))}
          <div ref={scrollRef} />
        </div>

        {/* Input Area */}
        <div className="p-6 bg-white border-t border-slate-200">
          <div className="max-w-4xl mx-auto relative">
            <textarea
              value={input}
              onChange={(e) => setInput(e.target.value)}
              placeholder="输入您的回答..."
              className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 pr-32 focus:outline-none focus:ring-2 focus:ring-blue-500/50 resize-none h-24 shadow-inner"
              onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && (e.preventDefault(), handleSend())}
            />
            <div className="absolute bottom-4 right-4 flex gap-2">
               <Button size="sm" onClick={handleSend} icon={ArrowRight}>发送</Button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// --- View C: Outline Editor ---
const OutlineEditor = ({ onNavigate }) => {
  const [activeTab, setActiveTab] = useState(0);

  const outlines = [
    { title: "方案 A：强调机制创新", focus: "Innovation", content: [
      { id: 1, title: "一、立项依据", subs: ["1.1 临床问题与科学假设", "1.2 国内外研究现状分析"] },
      { id: 2, title: "二、研究内容", subs: ["2.1 关键分子X的筛选验证", "2.2 信号通路Y的调控机制"] },
      { id: 3, title: "三、研究方案", subs: ["3.1 技术路线图", "3.2 实验方法与统计学"] }
    ]},
    { title: "方案 B：强调临床转化", focus: "Application", content: [
      { id: 1, title: "一、立项依据", subs: ["1.1 疾病负担与诊疗瓶颈", "1.2 新技术的应用前景"] },
      { id: 2, title: "二、研究内容", subs: ["2.1 诊断模型的构建", "2.2 临床样本的大队列验证"] },
      { id: 3, title: "三、特色与创新", subs: ["3.1 跨学科交叉优势", "3.2 临床应用价值"] }
    ]}
  ];

  return (
    <div className="max-w-7xl mx-auto p-6 lg:p-12 w-full animate-in fade-in">
      <div className="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
        <div>
          <Button variant="ghost" size="sm" icon={ArrowLeft} onClick={() => onNavigate('dashboard')} className="-ml-4 mb-2">返回</Button>
          <h2 className="text-3xl text-slate-900">大纲生成与确认</h2>
        </div>
        <div className="flex gap-3">
          <Button variant="secondary" icon={RefreshCw}>重新生成</Button>
          <Button onClick={() => onNavigate('editor')} icon={CheckCircle2}>确认并生成全文</Button>
        </div>
      </div>

      <div className="grid lg:grid-cols-[300px_1fr] gap-8 h-[600px]">
        {/* Sidebar: Versions */}
        <div className="space-y-4">
          <p className="text-sm font-medium text-slate-500 uppercase tracking-wider mb-2">CANDIDATES</p>
          {outlines.map((plan, idx) => (
            <div 
              key={idx}
              onClick={() => setActiveTab(idx)}
              className={`p-5 rounded-xl border cursor-pointer transition-all ${
                activeTab === idx 
                  ? 'bg-white border-[#0052FF] ring-1 ring-[#0052FF] shadow-lg shadow-blue-500/10' 
                  : 'bg-white border-slate-200 hover:border-blue-200'
              }`}
            >
              <div className="flex justify-between items-start mb-2">
                <Badge color={activeTab === idx ? 'blue' : 'slate'}>{plan.focus}</Badge>
                {activeTab === idx && <CheckCircle2 size={16} className="text-[#0052FF]" />}
              </div>
              <h4 className="font-bold text-slate-900 mb-1">{plan.title}</h4>
              <p className="text-xs text-slate-500">贴合度 95% • 结构完整</p>
            </div>
          ))}
        </div>

        {/* Editor Area */}
        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm p-8 overflow-y-auto">
          <div className="space-y-6">
            {outlines[activeTab].content.map((section) => (
              <div key={section.id} className="group">
                <div className="flex items-center gap-3 mb-3 p-2 rounded-lg hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all">
                  <div className="text-slate-400 cursor-move"><MoreHorizontal size={16} /></div>
                  <h3 className="text-xl font-bold text-slate-900 flex-1">{section.title}</h3>
                  <div className="opacity-0 group-hover:opacity-100 flex gap-2">
                     <Button size="sm" variant="ghost" className="h-8 w-8 p-0"><Plus size={14}/></Button>
                  </div>
                </div>
                <div className="pl-10 space-y-2 border-l-2 border-slate-100 ml-4">
                  {section.subs.map((sub, sIdx) => (
                    <div key={sIdx} className="p-2 text-slate-600 hover:text-[#0052FF] hover:bg-blue-50 rounded cursor-text transition-colors text-sm font-medium flex justify-between items-center group/item">
                      {sub}
                      <PenTool size={12} className="opacity-0 group-hover/item:opacity-100 text-slate-400" />
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

// --- View D: Full Text Editor ---
const DocEditor = ({ onNavigate }) => {
  return (
    <div className="flex h-[calc(100vh-80px)] w-full animate-in fade-in">
      {/* Doc Canvas */}
      <div className="flex-1 bg-slate-100 overflow-y-auto p-8 flex justify-center">
        <div className="bg-white w-[800px] min-h-[1000px] shadow-sm p-16 relative">
          <h1 className="text-3xl font-doc font-bold text-center mb-12 text-black">
            基于深度学习的蛋白质结构预测研究
          </h1>
          
          <div className="space-y-8 font-doc text-lg leading-relaxed text-slate-800 text-justify">
            <section>
              <h2 className="text-xl font-bold mb-4">一、立项依据</h2>
              <p className="mb-4">
                蛋白质结构预测是生物信息学领域的核心问题之一。尽管 AlphaFold2 <sup className="text-blue-600 text-xs font-sans cursor-pointer hover:underline">[1]</sup> 已经取得了突破性进展，但在多结构域蛋白质复合物的动态构象预测方面仍面临巨大挑战。
              </p>
              <p>
                本研究拟提出一种基于图神经网络的新型架构，旨在解决长程残基相互作用的建模难题。根据最新的研究表明 <sup className="text-blue-600 text-xs font-sans cursor-pointer hover:underline">[2]</sup>，引入物理约束可以显著提高预测的物理合理性。
              </p>
            </section>
            
            <section>
              <h2 className="text-xl font-bold mb-4">二、研究内容</h2>
              <p className="mb-4">
                1. 构建高精度的蛋白质动态数据集。利用分子动力学模拟生成...
              </p>
              <div className="p-4 bg-blue-50/50 border border-blue-100 rounded-lg text-sm font-sans text-slate-600 my-4 flex gap-3 items-start">
                 <Sparkles className="text-[#0052FF] flex-shrink-0 mt-0.5" size={16} />
                 <div>
                   <span className="font-bold text-[#0052FF]">AI 建议扩写：</span>
                   此处建议增加关于数据集清洗标准的具体描述，以体现数据的可靠性。
                 </div>
              </div>
              <p>
                2. 开发融合物理先验知识的图注意力网络模型。
              </p>
            </section>
          </div>
        </div>
      </div>

      {/* Right Sidebar: Tools */}
      <div className="w-80 bg-white border-l border-slate-200 flex flex-col">
        <div className="h-14 border-b border-slate-200 flex items-center px-4 gap-4">
           <div className="font-bold text-slate-900">辅助工具</div>
        </div>
        
        <div className="p-4 space-y-6 flex-1 overflow-y-auto">
          {/* References */}
          <div>
            <h4 className="text-xs font-mono-custom uppercase text-slate-500 mb-3 flex items-center gap-2">
              <BookOpen size={14}/> References (2)
            </h4>
            <div className="space-y-3">
              <div className="text-sm bg-slate-50 p-3 rounded-lg border border-slate-100 hover:border-blue-200 cursor-pointer hover:shadow-sm transition-all">
                <div className="font-bold text-slate-900 mb-1 line-clamp-2">Highly accurate protein structure prediction with AlphaFold</div>
                <div className="text-xs text-slate-500">Nature, 2021</div>
              </div>
              <div className="text-sm bg-slate-50 p-3 rounded-lg border border-slate-100 hover:border-blue-200 cursor-pointer hover:shadow-sm transition-all">
                <div className="font-bold text-slate-900 mb-1 line-clamp-2">Geometric Deep Learning for Biomolecules</div>
                <div className="text-xs text-slate-500">arXiv, 2023</div>
              </div>
              <Button size="sm" variant="secondary" className="w-full text-xs" icon={Search}>检索更多文献</Button>
            </div>
          </div>

          {/* Export */}
          <div className="pt-6 border-t border-slate-100">
             <h4 className="text-xs font-mono-custom uppercase text-slate-500 mb-3 flex items-center gap-2">
              <FileDown size={14}/> Export
            </h4>
            <div className="grid grid-cols-2 gap-2">
              <Button variant="secondary" size="sm">Word (.docx)</Button>
              <Button variant="secondary" size="sm">PDF</Button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// --- 4. Landing Page Components ---

const Navbar = ({ onLogin }) => (
  <nav className="fixed top-0 w-full z-50 bg-[#FAFAFA]/80 backdrop-blur-md border-b border-slate-200/50">
    <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
      <div className="flex items-center gap-2 cursor-pointer" onClick={() => window.location.reload()}>
        <div className="w-8 h-8 rounded-lg bg-gradient-primary flex items-center justify-center text-white font-bold font-serif">
          S
        </div>
        <span className="font-serif text-xl font-bold tracking-tight">校研智申</span>
      </div>
      <div className="hidden md:flex items-center gap-8 text-sm font-medium text-slate-600">
        <a href="#features" className="hover:text-[#0052FF] transition-colors">核心功能</a>
        <a href="#process" className="hover:text-[#0052FF] transition-colors">生成流程</a>
        <a href="#security" className="hover:text-[#0052FF] transition-colors">数据安全</a>
      </div>
      <div className="flex items-center gap-4">
        <span className="text-sm font-medium text-slate-500 hidden sm:block">MVP v1.0</span>
        <Button variant="outline" className="!h-10 !px-5 text-sm rounded-lg" onClick={onLogin}>登录</Button>
      </div>
    </div>
  </nav>
);

const Hero = ({ onStart }) => {
  return (
    <section className="relative pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden">
      <div className="absolute inset-0 hero-pattern pointer-events-none" />
      <div className="absolute top-0 right-0 w-[800px] h-[800px] bg-blue-100/40 rounded-full blur-[120px] -translate-y-1/2 translate-x-1/3 pointer-events-none" />
      
      <div className="max-w-7xl mx-auto px-6 grid lg:grid-cols-[1.1fr_0.9fr] gap-12 lg:gap-20 items-center">
        <motion.div 
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, ease: [0.16, 1, 0.3, 1] }}
        >
          <SectionLabel text="AI-Powered Research" />
          <h1 className="text-5xl lg:text-7xl leading-[1.1] mb-8 text-slate-900">
            让科研回归 <br />
            <span className="text-gradient">创造与思考</span>
          </h1>
          <p className="text-lg text-slate-600 leading-relaxed mb-10 max-w-xl">
            面向校内科研人员的智能化国自然申请书生成系统。
            从深度访谈到全文生成，我们将繁琐的文书工作转化为流畅的思维对话。
          </p>
          <div className="flex flex-col sm:flex-row gap-4">
            <Button icon={ArrowRight} onClick={onStart}>开始申请书生成</Button>
            <Button variant="outline">查看演示视频</Button>
          </div>
          <div className="mt-12 flex items-center gap-6 text-sm font-medium text-slate-500 font-mono-custom">
            <span className="flex items-center gap-2"><CheckCircle2 className="w-4 h-4 text-[#0052FF]" /> 校内专网访问</span>
            <span className="flex items-center gap-2"><CheckCircle2 className="w-4 h-4 text-[#0052FF]" /> 学术资料库</span>
          </div>
        </motion.div>

        <div className="relative h-[400px] lg:h-[600px] hidden lg:block perspective-[2000px]">
          <motion.div 
            animate={{ y: [0, -20, 0] }}
            transition={{ duration: 6, repeat: Infinity, ease: "easeInOut" }}
            className="absolute top-1/4 left-10 z-20"
          >
            <div className="bg-white p-6 rounded-2xl shadow-xl shadow-blue-900/10 border border-slate-100 w-64">
              <div className="h-2 w-16 bg-blue-100 rounded mb-4" />
              <div className="h-3 w-full bg-slate-100 rounded mb-2" />
              <div className="h-3 w-4/5 bg-slate-100 rounded mb-2" />
              <div className="h-3 w-3/5 bg-slate-100 rounded" />
              <div className="mt-4 flex gap-2">
                <span className="h-2 w-2 rounded-full bg-[#0052FF]" />
                <span className="text-[10px] text-slate-400 font-mono-custom">GENERATING...</span>
              </div>
            </div>
          </motion.div>

          <motion.div 
            animate={{ y: [0, 30, 0] }}
            transition={{ duration: 7, repeat: Infinity, ease: "easeInOut", delay: 1 }}
            className="absolute bottom-1/4 right-10 z-10"
          >
             <div className="bg-white p-5 rounded-2xl shadow-xl shadow-blue-900/10 border border-slate-100 w-56 flex items-center gap-4">
               <div className="w-10 h-10 rounded-full bg-green-50 flex items-center justify-center text-green-600"><ShieldCheck className="w-5 h-5" /></div>
               <div>
                 <div className="text-xs text-slate-400 font-mono-custom uppercase">Status</div>
                 <div className="font-serif font-bold text-slate-800">循证核验通过</div>
               </div>
             </div>
          </motion.div>

          <motion.div animate={{ rotate: 360 }} transition={{ duration: 60, repeat: Infinity, ease: "linear" }} className="absolute inset-0 border border-dashed border-blue-200 rounded-full opacity-50" />
          <motion.div animate={{ rotate: -360 }} transition={{ duration: 80, repeat: Infinity, ease: "linear" }} className="absolute inset-[15%] border border-dashed border-blue-100 rounded-full opacity-60" />
          <div className="absolute inset-[30%] bg-gradient-primary rounded-full blur-[80px] opacity-20" />
        </div>
      </div>
    </section>
  );
};

const FeatureCard = ({ icon: Icon, title, desc, delay }) => (
  <motion.div 
    initial={{ opacity: 0, y: 20 }}
    whileInView={{ opacity: 1, y: 0 }}
    viewport={{ once: true, margin: "-100px" }}
    transition={{ delay, duration: 0.5 }}
    className="bg-white rounded-2xl p-8 border border-slate-100 card-hover-effect relative overflow-hidden group"
  >
    <div className="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-100 transition-opacity duration-500">
      <ArrowRight className="w-5 h-5 -rotate-45 text-[#0052FF]" />
    </div>
    <div className="w-12 h-12 rounded-xl bg-blue-50 text-[#0052FF] flex items-center justify-center mb-6 group-hover:bg-[#0052FF] group-hover:text-white transition-colors duration-300">
      <Icon className="w-6 h-6" />
    </div>
    <h3 className="text-xl font-bold mb-3 text-slate-900">{title}</h3>
    <p className="text-slate-500 leading-relaxed text-sm">
      {desc}
    </p>
  </motion.div>
);

const Features = () => (
  <section id="features" className="py-24 bg-white relative">
    <div className="max-w-7xl mx-auto px-6">
      <div className="mb-16 md:w-2/3">
        <SectionLabel text="Core Capabilities" />
        <h2 className="text-4xl md:text-5xl text-slate-900 mb-6">
          全流程<span className="text-gradient">智能化</span>辅助
        </h2>
        <p className="text-lg text-slate-600">
          针对国自然申请书结构深度定制，从灵感到定稿，每一个环节都经过精心设计。
        </p>
      </div>

      <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        <FeatureCard icon={MessageSquareText} title="动态需求访谈" desc="纯对话式交互，AI 根据回答自动追问。不设硬性门槛，在自然交流中完成信息采集。" delay={0.1} />
        <FeatureCard icon={FileText} title="大纲生成与编辑" desc="一次生成 2-5 套候选大纲。支持细粒度调整至最小标题层级，提供版本回退与对比。" delay={0.2} />
        <FeatureCard icon={Database} title="学术循证检索" desc="全网检索 + 学术来源优先评分。严控内容来源，杜绝虚构文献，确保立项依据扎实。" delay={0.3} />
        <FeatureCard icon={PenTool} title="一键全文生成" desc="过程可视化。自动组织语言、关联文献。支持 Word/PDF 导出，符合 2026 申报规范。" delay={0.4} />
      </div>
    </div>
  </section>
);

const StatCard = ({ number, label }) => (
  <div className="border-l border-white/20 pl-6">
    <div className="text-4xl lg:text-5xl font-serif text-white mb-2">{number}</div>
    <div className="text-blue-200 font-medium text-sm tracking-wide uppercase font-mono-custom">{label}</div>
  </div>
);

const StatsSection = () => (
  <section className="py-24 bg-slate-900 relative overflow-hidden">
    <div className="absolute inset-0 opacity-10" style={{ backgroundImage: 'radial-gradient(circle, #ffffff 1px, transparent 1px)', backgroundSize: '30px 30px' }}></div>
    <div className="max-w-7xl mx-auto px-6 relative z-10 grid lg:grid-cols-2 gap-16 items-center">
      <div>
        <div className="inline-flex items-center gap-2 mb-6 bg-white/10 px-4 py-1.5 rounded-full border border-white/10">
          <span className="h-2 w-2 rounded-full bg-green-400 animate-pulse"></span>
          <span className="text-xs text-white font-mono-custom tracking-widest">SYSTEM READY</span>
        </div>
        <h2 className="text-4xl md:text-5xl text-white mb-6">专为科研场景打造<br/><span className="text-blue-400">数据安全可控</span></h2>
        <p className="text-slate-400 text-lg mb-8 max-w-md">校内私有化部署方案，数据“软删除”归档策略，让您的科研创意在安全的环境中生长。</p>
        <Button variant="primary" className="!bg-white !text-slate-900 hover:!bg-blue-50">了解部署方案</Button>
      </div>
      <div className="grid grid-cols-2 gap-y-12 gap-x-8">
        <StatCard number="2-5套" label="候选大纲/次" />
        <StatCard number="100%" label="学术来源优先" />
        <StatCard number="100人" label="首批试点规模" />
        <StatCard number="v1.0" label="MVP 已就绪" />
      </div>
    </div>
  </section>
);

const StepLine = () => (
  <section id="process" className="py-24 bg-[#FAFAFA]">
    <div className="max-w-6xl mx-auto px-6">
      <div className="text-center mb-16">
        <SectionLabel text="Workflow" />
        <h2 className="text-4xl text-slate-900">简单的三步流程</h2>
      </div>
      <div className="relative">
        <div className="hidden md:block absolute top-12 left-0 w-full h-0.5 bg-slate-200"></div>
        <div className="grid md:grid-cols-3 gap-12">
          {[
            { step: "01", title: "对话访谈", desc: "如同与资深专家对话，AI 引导您梳理研究思路。", icon: MessageSquareText },
            { step: "02", title: "大纲确立", desc: "多版本对比，拖拽式调整，锁定最完美的逻辑结构。", icon: Cpu },
            { step: "03", title: "生成与导出", desc: "一键生成数万字初稿，支持 Word 格式直接申报。", icon: Zap }
          ].map((item, index) => (
            <div key={index} className="relative bg-[#FAFAFA] md:pt-8 group">
              <div className="hidden md:flex absolute top-12 left-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white border-4 border-slate-200 rounded-full z-10 items-center justify-center transition-colors group-hover:border-[#0052FF]">
                 <div className="w-2 h-2 rounded-full bg-slate-300 group-hover:bg-[#0052FF]"></div>
              </div>
              <div className="bg-white p-8 rounded-2xl border border-slate-100 shadow-sm group-hover:shadow-xl transition-all duration-500 relative z-20 mt-4">
                <div className="text-4xl font-serif text-slate-100 absolute top-4 right-4 font-bold">{item.step}</div>
                <div className="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center text-[#0052FF] mb-6"><item.icon className="w-6 h-6" /></div>
                <h3 className="text-xl font-bold mb-3">{item.title}</h3>
                <p className="text-slate-500 text-sm leading-relaxed">{item.desc}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </section>
);

const Footer = () => (
  <footer className="bg-white border-t border-slate-200 py-12">
    <div className="max-w-7xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center gap-6">
      <div className="flex items-center gap-2">
        <div className="w-6 h-6 rounded bg-slate-900 flex items-center justify-center text-white font-bold font-serif text-xs">S</div>
        <span className="font-serif font-bold text-slate-900">校研智申</span>
        <span className="ml-2 text-xs bg-slate-100 px-2 py-0.5 rounded text-slate-500 font-mono-custom">MVP BUILD 2026.02.14</span>
      </div>
      <div className="text-slate-400 text-sm">© 2026 School Research AI. Internal Use Only.</div>
    </div>
  </footer>
);

const LandingPage = ({ onStart }) => (
  <>
    <Navbar onLogin={onStart} />
    <Hero onStart={onStart} />
    <Features />
    <StatsSection />
    <StepLine />
    <section className="py-24 px-6 text-center">
      <div className="max-w-3xl mx-auto bg-gradient-to-br from-slate-50 to-white border border-slate-200 p-12 rounded-3xl shadow-2xl shadow-blue-900/5">
        <h2 className="text-4xl font-serif mb-6 text-slate-900">准备好开始了吗？</h2>
        <p className="text-slate-600 mb-8 max-w-lg mx-auto">
          立即加入首批 100 人试点计划，体验 AI 辅助科研申请书写作的效率变革。
        </p>
        <Button className="w-full sm:w-auto px-10" onClick={onStart}>立即申请试用</Button>
      </div>
    </section>
    <Footer />
  </>
);

// --- 5. Main App Controller ---

const App = () => {
  const [view, setView] = useState('landing'); // landing, dashboard, interview, outline, editor

  const renderView = () => {
    switch(view) {
      case 'landing': return <LandingPage onStart={() => setView('dashboard')} />;
      case 'dashboard': return <Dashboard onNavigate={setView} />;
      case 'interview': return <Interview onNavigate={setView} />;
      case 'outline': return <OutlineEditor onNavigate={setView} />;
      case 'editor': return <DocEditor onNavigate={setView} />;
      default: return <LandingPage onStart={() => setView('dashboard')} />;
    }
  };

  return (
    <div className="min-h-screen bg-[#FAFAFA] text-slate-900 font-sans selection:bg-[#0052FF] selection:text-white">
      <FontLoader />
      
      {/* App Shell Header (Only visible inside app) */}
      {view !== 'landing' && (
        <header className="h-20 bg-white border-b border-slate-200 sticky top-0 z-50 px-6 flex items-center justify-between">
          <div className="flex items-center gap-3 cursor-pointer" onClick={() => setView('dashboard')}>
            <div className="w-8 h-8 rounded-lg bg-gradient-primary flex items-center justify-center text-white font-bold font-serif">S</div>
            <span className="font-serif text-lg font-bold hidden md:block">校研智申</span>
          </div>
          
          <div className="flex items-center gap-4">
            <div className="hidden md:flex items-center gap-6 mr-4">
              <span className={`text-sm font-medium cursor-pointer transition-colors ${view === 'dashboard' ? 'text-[#0052FF]' : 'text-slate-500 hover:text-slate-900'}`} onClick={() => setView('dashboard')}>工作台</span>
              <span className={`text-sm font-medium cursor-pointer transition-colors ${view === 'interview' ? 'text-[#0052FF]' : 'text-slate-500 hover:text-slate-900'}`} onClick={() => setView('interview')}>访谈</span>
              <span className={`text-sm font-medium cursor-pointer transition-colors ${view === 'outline' ? 'text-[#0052FF]' : 'text-slate-500 hover:text-slate-900'}`} onClick={() => setView('outline')}>大纲</span>
              <span className={`text-sm font-medium cursor-pointer transition-colors ${view === 'editor' ? 'text-[#0052FF]' : 'text-slate-500 hover:text-slate-900'}`} onClick={() => setView('editor')}>写作</span>
            </div>
            <div className="h-8 w-px bg-slate-200 hidden md:block" />
            <div className="flex items-center gap-2">
               <div className="w-8 h-8 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-600">
                  <User size={16} />
               </div>
               <span className="text-sm font-medium text-slate-700 hidden sm:block">张教授</span>
            </div>
            <Button variant="ghost" size="sm" className="!px-2 text-slate-400 hover:text-red-500" onClick={() => setView('landing')}><LogOut size={18}/></Button>
          </div>
        </header>
      )}

      {/* Main Content Area */}
      <main className="flex-1 flex flex-col relative">
        <AnimatePresence mode='wait'>
          <motion.div
            key={view}
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -10 }}
            transition={{ duration: 0.3 }}
            className="w-full flex-grow flex flex-col"
          >
            {renderView()}
          </motion.div>
        </AnimatePresence>
      </main>
    </div>
  );
};

export default App;